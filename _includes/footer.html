<footer>
    <div class="container">
        <div class="row">
            <div class="col-12">
                
            </div>
        </div>
    </div>
</footer>
<script src='{{ site.baseurl }}/andrew/js/jquery-2.1.3.min.js'></script>
<script>
$(function() {
    var markers;
    var geocoder;
    var markerIcon = L.divIcon({
      className: 'marker',
      iconSize: [5, 5]
    });

    function showLocation(location) {
        // set map
        map.setView([location.features[0].center[1], location.features[0].center[0]], 8);
        // add marker
        L.marker([location.features[0].center[1], location.features[0].center[0]], { icon: markerIcon})
            .addTo(map);

        // setup up query string
        // this accounts for town/city names having spaces
        // last piece is the state abbr (in the <span>)
        var queryName = '';
        $.each(location.query, function (i, namePart) {
            if (i === location.query.length - 1) {
                queryName = queryName + ', <span>' + namePart + '</span>';
            } else {
                queryName = queryName + namePart + ' ';
            }
        });
        
        // append data
        $('#data').append('<div class="result">'
            +'<p class="query">' + queryName + '</p>'
            + '<h5>' + location.features[0].center[1] + ', ' + location.features[0].center[0] + '</h5>'
            + '<p>' + location.features[0].place_name + '</p>'
            + '</div>');
    }

    function renderResults(err, data) {
        if (data.results.length === undefined) {
            showLocation(data.results);
        } else {
            $.each(data.results, function(i, result) {
                showLocation(result);
            });
            $('#count').append('Showing ' + data.results.length + ' results');
        }
        // show data
        $('#downloads').css('display', 'block');
        $('#data').css('display', 'block');
        $('#count').css('display', 'block');
    }

    function setupGeoCoder() {
        // clear previous results
        $('#downloads').css('display', 'none');
        $('#data').css('display', 'none');
        $('#count').css('display', 'none');
        $('#data').html('');
        $('#count').html('');

        // clear existing layers
        map.eachLayer(function(layer) {
            if (layer instanceof L.Marker || layer instanceof L.Polyline) {
                map.removeLayer(layer);
            }
        });

        // if there is no ;
        // single address
        if ($('#address').val().indexOf(';') === -1) {
            var geocoder = L.mapbox.geocoder('mapbox.places');
            geocoder.query($('#address').val(), renderResults);
        // else batch
        } else {
            var geocoder = L.mapbox.geocoder('mapbox.places-permanent');
            geocoder.query($('#address').val() , renderResults);
        }
    }

    // set map size
    $('#map').height(($(document).height() - $('header').height() - 40) + 'px');

    // load base
    L.mapbox.accessToken = 'pk.eyJ1IjoiY2ZwYiIsImEiOiJodmtiSk5zIn0.VkCynzmVYcLBxbyHzlvaQw';
    var map = L.mapbox.map('map', 'cfpb.k55b27gd', { zoomControl: false })
        .setView([39.8282, -98.5795], 4);
    new L.Control.Zoom({ position: 'bottomright' }).addTo(map);
    map.scrollWheelZoom.disable();

    // on submit
    $('#geocode').submit(function(event) {
        setupGeoCoder();
        return false;
    });

    // on enter
    $('#address').keypress(function(e) {
        if (e.which == 13) {
            setupGeoCoder();
            return false;
        }
    });

    // file
    $('#batch').click(function() {
        var geocoder = L.mapbox.geocoder('mapbox.places-permanent');
        geocoder.query('cumberland, md; hagerstown, md; chambersburg, pa' , showBatch);
        return false;
    });
});
</script>

</body>
</html>